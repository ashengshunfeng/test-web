<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Stickman Ultra Minimal</title>
  <style>body { margin:0; overflow:hidden; background:#222; }</style>
</head>
<body>
<canvas id="game" width="800" height="500"></canvas>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
// Firebase config đúng của bạn
const firebaseConfig = {
  apiKey: "AIzaSyDCcrfHUbnpcQMCxoF1mxwUoE9wOJR2_GE",
  authDomain: "test-game-8a541.firebaseapp.com",
  databaseURL: "https://test-game-8a541-default-rtdb.firebaseio.com",
  projectId: "test-game-8a541",
  storageBucket: "test-game-8a541.appspot.com",
  messagingSenderId: "396403313237",
  appId: "1:396403313237:web:3eeb142c4ffaffbd5962dc"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let players = {};
let localId = null;
let x = Math.random()*canvas.width;
let y = Math.random()*canvas.height;
let color = '#' + Math.floor(Math.random()*16777215).toString(16);

function promptNick(){
  let n = prompt('Nickname?');
  if(!n||n.length<2) return promptNick();
  return n;
}
let nickname = promptNick();

function connectGame(){
  const ref = db.ref('players').push();
  localId = ref.key;
  ref.set({nickname, color, x, y});
  ref.onDisconnect().remove();
  setInterval(()=>{
    if(localId) db.ref('players/'+localId).update({x,y});
  },70);
  db.ref('players').on('value', snap => { players = snap.val()||{}; });
  canvas.addEventListener('mousemove', e => {
    const rect = canvas.getBoundingClientRect();
    x = e.clientX - rect.left;
    y = e.clientY - rect.top;
  });
  renderLoop();
}

function renderLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const pid in players){
    const p = players[pid];
    ctx.save();
    ctx.strokeStyle=p.color; ctx.lineWidth=4;
    ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(p.x,p.y+35); ctx.stroke();
    ctx.beginPath(); ctx.arc(p.x, p.y-9, 9, 0, 2*Math.PI); ctx.stroke();
    ctx.font = 'bold 13px Arial';
    ctx.fillStyle = '#fff';
    ctx.textAlign='center';
    ctx.fillText(p.nickname, p.x, p.y-16);
    ctx.restore();
  }
  requestAnimationFrame(renderLoop);
}
connectGame();
</script>
</body>
</html>
